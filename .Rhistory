meanAge=mean(年齡),
meanHos=mean(住院天數))
```
group_by_(DiagSumS,.dots=groups%>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
```
group_by(DiagSumS,.dots=groups) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
groups<-c("院區","性別")
group_by(DiagSumS,.dots=groups) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by_(DiagSumS,.dots=groups) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
DiagSumS$院區
group_by_(DiagSumS,.dots=groups) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by_(DiagSumS,get(院區)) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by_(DiagSumS,groups) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by_(DiagSumS,iconv(groups), to ="UTF-8") %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by_(DiagSumS,iconv(groups, to ="UTF-8")) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by_(DiagSumS,.dots=iconv(groups, to ="UTF-8")) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by_(DiagSumS,.dots=院區) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by_(DiagSumS,.dots=性別) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group1<-group_by(DiagSumS,.dots=性別)%>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by(DiagSumS,.dots=性別)%>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by_(DiagSumS,.dots=性別) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by(DiagSumS,.dots=性別) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by(DiagSumS,.dots=院區) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by(DiagSumS,.dots=院區,性別) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by(DiagSumS,.dots=院區,.dots=性別) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by(DiagSumS,.dots=.(院區,性別)) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by(DiagSumS,.dots=list(院區,性別)) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by(DiagSumS,.dots=c("院區","性別")) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by_(DiagSumS,.dots=c("院區","性別")) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
dots <- lapply(c("院區","性別"), as.symbol)
group_by(DiagSumS,.dots=dots) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
dots <- lapply(c("院區","性別"), as.symbol)
group_by(DiagSumS,.dots=dots) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
dots
df <-  data.frame(
asihckhdoydk = sample(LETTERS[1:3], 100, replace=TRUE),
a30mvxigxkgh = sample(LETTERS[1:3], 100, replace=TRUE),
value = rnorm(100)
)
# Columns you want to group by
grp_cols <- names(df)[-3]
# Convert character vector to list of symbols
dots <- lapply(grp_cols, as.symbol)
dots
group_by_(DiagSumS,.dots=dots) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
dots <- lapply(c("院區","性別"), as.symbol)
group_by_(DiagSumS,.dots=dots) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
DiagSumE <- rename(DiagSumS, Hosp = 院區,Gender=性別)
group_by_(DiagSumE,Hosp,Gender) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
group_by(DiagSumE,Hosp,Gender) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數))
arrange(DiagSumS,
desc(住院天數),
desc(年齡))
group_by(DiagSumE,Hosp,Gender) %>%
summarise(nRecord=n(),
meanAge=mean(年齡),
meanHos=mean(住院天數)) %>%
arrange(desc(meanHos))
DiagSumE[1:5,1:2]
arrange(DiagSumS,住院天數) %>% select(院區,住院天數)
arrange1<-arrange(DiagSumS,住院天數) %>% select(院區,住院天數)
1+1
1+1
2+2
1+1
1+1
2+2
3+3
4+4
5+5+
5
6+6
6+6
6+
?mean
?seq
seq(2,20,2)
a[4]
a<-1:10
a[4]
b[c(5,6,7)]
b<-seq(2,20,2)
b[c(5,6,7)]
a<-1:10
b<-seq(2,10,2)
a+b
a<-c(1,2,3)
b<-c(1,2)
a+b
library(readr)
BasicS <- read_csv("C:/Users/yjtseng/Dropbox/CGU/CGMH_R/BasicS.csv")
View(BasicS)
View(BasicS)
EMDiagS <- read_csv("EMDiagS.csv") #自行載入
class(EMDiagS$資料年月)
as.character(EMDiagS$資料年月)
class(EMDiagS$資料年月)
install.packages("lumbirdate")
EMDiagS$資料年月
class(EMDiagS$資料年月)
library(lubridate)
EMDiagS$資料年月
class(EMDiagS$資料年月)
EMDiagS$輸入日期
class(EMDiagS$輸入日期)
EMDiagS$輸入日期
class(EMDiagS$輸入日期)
ymd(EMDiagS$輸入日期)
EMDiagS$輸入日期
class(EMDiagS$輸入日期)
EMDiagS$輸入日期<-ymd(EMDiagS$輸入日期)
class(EMDiagS$輸入日期)
weekdays(EMDiagS$輸入日期)
grep("250",EMDiagS)
grep("250",EMDiagS$疾病碼)
grep("250",EMDiagS$疾病碼,value=T)
grep("250",EMDiagS$疾病碼)
grep("250",EMDiagS$疾病碼,value=T)
grep("^250",EMDiagS$疾病碼,value=T)
grepl("250",EMDiagS$疾病碼)
EMDiagS <- read_csv("EMDiagS.csv")
library(readr)
EMDiagS <- read_csv("EMDiagS.csv")
mean(EMDiagS$資料年齡)
View(EMDiagS)
table(EMDiagS$掛號科別)
mean(EMDiagS$疾病序號)
median(EMDiagS$疾病序號)
table(EMDiagS$掛號科別)
BasicS <- read_csv("BasicS.csv")
DiagSumS <- read_csv("DiagSumS.csv")
quantile(DiagSumS$住院天數)
table(DiagSumS$年齡,DiagSumS$住院天數)
cor(DiagSumS$年齡,DiagSumS$住院天數)
table(DiagSumS$`14天內再次住院註記`,DiagSumS$院區)
table(DiagSumS$院區,DiagSumS$`14天內再次住院註記`)
knitr::kable(filter1 %>% select(院區,來源別,診斷類別1))
knitr::kable(filter1 %>% select(院區,來源別,ends_with("日期")))
summarise(DiagSumS,
nRecord=n(),
nID=n_distinct(歸戶代號),
nSource=n_distinct(來源別))
library(dplyr)
DiagSumS %>% filter(grepl("腫瘤",診斷類別名稱1))
DiagSumS %>% summarise(grepl("腫瘤",診斷類別名稱1))
DiagSumS %>% summarise(sum(grepl("腫瘤",診斷類別名稱1)))
DiagSumS %>% summarise(sum(grepl("腫瘤",診斷類別名稱1)),sum(來源別=="E"))
library(tidyr)
?gather
library(dplyr)
mini_iris <-
iris %>%
group_by(Species) %>%
slice(1)
mini_iris %>% gather(key = flower_att, value = measurement, -Species)
?spread
head(DiagSumS)
head(DiagSumS %>% select(starts_with("診斷類別")),3)
head(DiagSumS %>% select(starts_with("診斷類別"),-contains("名稱")),3)
airqualityM<-gather(DiagWide,診斷類別,診斷碼) ##欄位需要保留"Month","Day"
DiagLong<-gather(DiagWide,診斷類別,診斷碼,-住院號) ##欄位需要保留"Month","Day"
DiagWide<-DiagSumS %>%
select(住院號,starts_with("診斷類別"),-contains("名稱"))
DiagLong<-gather(DiagWide,診斷類別,診斷碼,-住院號)
DiagLong
View(DiagLong)
head(DiagLong %>% arrange(住院號))
library(tableone)
DiagSumS
CreateTableOne(data=DiagSumS,strata = "性別",vars = "年齡")
View(DiagSumS)
CreateTableOne(data=DiagSumS,strata = "性別",vars = c("年齡","14天內再次住院註記"))
CreateTableOne(data=DiagSumS,strata = "性別",vars = c("年齡","`14天內再次住院註記`"))
CreateTableOne(data=DiagSumS,strata = "性別",vars = c("年齡","來源別"))
CreateTableOne(data=DiagSumS,strata = "性別",vars = c("年齡","來源別","住院天數"))
?chisq.test
chisq.test(table(DiagSumS$院區,
DiagSumS$`14天內再次住院註記`))
chisq.test(table(DiagSumS$院區,
DiagSumS$`14天內再次住院註記`))
table(DiagSumS$院區,
DiagSumS$`14天內再次住院註記`)
t.test(`14天內再次住院註記`~住院天數,DiagSumS)
t.test(住院天數~`14天內再次住院註記`,DiagSumS)
CreateTableOne(data=DiagSumS,strata = "性別",vars = c("年齡","來源別","住院天數"))
?CreateTableOne
print(t1, quote = TRUE, noSpaces = TRUE)
t1<-CreateTableOne(data=DiagSumS,
strata = "性別",
vars = c("年齡","來源別","住院天數"))
print(t1, quote = TRUE, noSpaces = TRUE)
DiagSumS$年齡
```
?cut
cut(DiagSumS$年齡,breaks = c(18,65))
summary(DiagSumS$年齡)
cut(DiagSumS$年齡,breaks = c(50,65))
cut(DiagSumS$年齡,breaks = c(50,65),labels = c("<=50","50~65",">65"))
cut(DiagSumS$年齡,breaks = c(18,50,65),labels = c("<=50","50~65",">65"))
cut(DiagSumS$年齡,breaks = c(50,65),labels = c("<=50","50~65",">65"))
cut(DiagSumS$年齡,breaks = c(0,50,65),labels = c("<=50","50~65",">65"))
cut(DiagSumS$年齡,breaks = c(0,50,65))
summary(DiagSumS$年齡)
cut(DiagSumS$年齡,breaks = c(0,50,65,100))
cut(DiagSumS$年齡,breaks = c(0,50,65,100),labels = 1:4)
cut(DiagSumS$年齡,breaks = c(0,50,65,100),labels = c("<=50","50-65",">65"))
table(DiagSumS$AgeGroup)
DiagSumS$AgeGroup<-
cut(DiagSumS$年齡,
breaks = c(0,50,65,100),
labels = c("<=50","50-65",">65"))
table(DiagSumS$AgeGroup)
summary(DiagSumS$居住地)
table(DiagSumS$居住地)
DiagSumS$ResGroup<-""
DiagSumS$ResGroup[grepl("台北|基隆|苗栗|桃園|新北市|新竹",DiagSumS$居住地)] <- "北"
DiagSumS$ResGroup[grepl("台中|雲林|彰化",DiagSumS$居住地)] <- "中"
DiagSumS$ResGroup[grepl("高雄|嘉義|屏東|台南",DiagSumS$居住地)] <- "南"
DiagSumS$ResGroup[grepl("臺東|宜蘭",DiagSumS$居住地)] <- "東"
table(DiagSumS$ResGroup)
library(icd)
icd_comorbid_ahrq？
?icd_comorbid_ahrq
icd_comorbid_ahrq(DiagSumS$診斷類別1)
icd_comorbid_ahrq(DiagSumS %>% rename(visit_name=住院號,icd_name=診斷類別1))
AHRQ<-icd_comorbid_ahrq(DiagSumS %>% rename(visit_name=住院號,icd_name=診斷類別1))
View(AHRQ)
head(AHRQ)
View(DiagSumS)
icd_guess_version(
"1196"
)
icd_guess_version(
"1196"
)
icd_comorbid_ahrq
?icd_comorbid_ahrq
AHRQ<-
icd10_comorbid_ahrq(
DiagSumS %>% filter(住院日期>20160101) %>%
rename(visit_name=住院號,icd_name=診斷類別1))
View(AHRQ)
DiagSumS %>% filter(住院日期>20160101)
DiagSumS %>% filter(住院日期>20160101) %>% select(診斷類別1)
DiagSumS %>% filter(住院日期>20160101) %>% select(診斷類別1) %>% arrange(診斷類別1)
icd_short_to_decimal(DiagSumS$診斷類別1)
library(readr)
DiagSumS <- read_csv("DiagSumS.csv")
library(treemap)
library(dplyr)
DiagSumS %>% group_by(院區,住院科別)
DiagSumS %>% group_by(院區,住院科別) %>% summarise(N=n(),HosDay=mean(住院天數))
DiagSumTree<-
DiagSumS %>% group_by(院區,住院科別) %>%
summarise(N=n(),HosDay=mean(住院天數))
DiagSumS$住院科別
library(treemap)
treemap(DiagSumTree,
index=c("院區", "住院科別"), #分組依據
vSize="N", #區塊大小
vColor="HosDay", #顏色深淺
type="value")
treemap(DiagSumTree,
index=c("院區", "住院科別"), #分組依據
vSize="N", #區塊大小
vColor="HosDay", #顏色深淺
type="value")
head(DiagSumS[,c("住院科別","住院天數","住院日期")])
DiagSumS %>% group_by(住院科別,住院科別,substr(住院日期,1,4))
DiagSumS %>% group_by(院區,住院科別,住院科別,substr(住院日期,1,4)) %>%
summarise()
DiagSumS %>% group_by(院區,住院科別,住院科別,substr(住院日期,1,4)) %>%
summarise(HosStay=mean(住院天數))
DiagSumHM<-DiagSumS %>% group_by(院區,住院科別,住院科別,substr(住院日期,1,4)) %>%
summarise(HosStay=mean(住院天數))
head(DiagSumHM)
DiagSumHM<-DiagSumS %>% group_by(院區,住院科別,住院科別,住院年=substr(住院日期,1,4)) %>%
summarise(HosStay=mean(住院天數))
head(DiagSumHM)
DiagSumHM %>% mutate(HosDept=paste(院區,住院科別))
DiagSumHM %>%
mutate(HosDept=paste(院區,住院科別,sep="-"))
library(ggplot2) #for ggplot()
ggplot(DiagSumHM, aes(住院年, HosDept)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue")
DiagSumHM %>%
mutate(HosDept=paste(院區,住院科別,sep="-"))
ggplot(DiagSumHM, aes(住院年, HosDept)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue")
DiagSumHM <- DiagSumHM %>%
mutate(HosDept=paste(院區,住院科別,sep="-"))
ggplot(DiagSumHM, aes(住院年, HosDept)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue")
View(DiagSumS)
DiagSumHM<-DiagSumS %>% group_by(院區,DRG,住院年=substr(住院日期,1,4)) %>%
summarise(HosStay=mean(住院天數))
head(DiagSumHM)
DiagSumHM <- DiagSumHM %>%
mutate(HosDept=paste(院區,住院科別,sep="-"))
DiagSumHM<-DiagSumS %>% group_by(院區,DRG,住院年=substr(住院日期,1,4)) %>%
summarise(HosStay=mean(住院天數))
DiagSumHM <- DiagSumHM %>%
mutate(HosDRG=paste(院區,DRG,sep="-"))
ggplot(DiagSumHM, aes(住院年, HosDRG)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue")
DiagSumHM<-DiagSumS %>% group_by(DRG,住院年=substr(住院日期,1,4)) %>%
summarise(HosStay=mean(住院天數))
head(DiagSumHM)
DiagSumHM
ggplot(DiagSumHM, aes(住院年, DRG)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue")
DiagSumHM<-DiagSumS %>% group_by(DRG,住院年=substr(住院日期,1,4)) %>%
summarise(HosStay=mean(住院天數),N=n())
head(DiagSumHM)
ggplot(DiagSumHM %>% filter(N>1), aes(住院年, DRG)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue")
ggplot(DiagSumHM %>% filter(N>3), aes(住院年, DRG)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue")
DiagSumHM<-DiagSumS %>% group_by(住院原科別,住院年=substr(住院日期,1,4)) %>%
summarise(HosStay=mean(住院天數),N=n())
DiagSumHM<-DiagSumS %>% group_by(住院原科別,住院年=substr(住院日期,1,4)) %>%
summarise(HosStay=mean(住院天數),N=n())
head(DiagSumHM)
library(ggplot2) #for ggplot()
ggplot(DiagSumHM %>% filter(N>3), aes(住院年, 住院原科別)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue")
head(DiagSumHM)
head(DiagSumHM)
DiagSumHM$住院原科別<-as.character(DiagSumHM$住院原科別)
ggplot(DiagSumHM %>% filter(N>3), aes(住院年, 住院原科別)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue")
DiagSumHM<-DiagSumS %>% group_by(住院科別,住院年=substr(住院日期,1,4)) %>%
summarise(HosStay=mean(住院天數),N=n())
head(DiagSumHM)
ggplot(DiagSumHM %>% filter(N>3), aes(住院年, 住院科別)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue")
ggplot(DiagSumHM %>% filter(N>5), aes(住院年, 住院科別)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue")
DiagSumHM
View(DiagSumHM)
ggplot(DiagSumHM %>% filter(N>10), aes(住院年, 住院科別)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue")
low = "white",high = "steelblue") +
theme_bw()
low = "white",high = "steelblue") +
theme_bw()
ggplot(DiagSumHM %>% filter(N>10), aes(住院年, 住院科別)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue") +
theme_bw()
ggplot(DiagSumHM, aes(住院年, 住院科別)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue") +
theme_bw()
DiagSumHM
DiagSumHM %>% filter(住院科別 %in% DiagSumHM %>% filter(N>10) %>% select(住院科別))
DiagSumHM %>% filter(住院科別 %in% DiagSumHM[DiagSumHM$N>10,]$住院科別)
DiagSumHM$N>10
DiagSumHM[DiagSumHM$N>10,]$住院科別
DiagSumHM %>% filter(住院科別 %in% DiagSumHM[DiagSumHM$N>10,]$住院科別)
DiagSumHM<-DiagSumS %>% group_by(住院科別,住院年=substr(住院日期,1,4)) %>%
summarise(HosStay=mean(住院天數),N=n())
head(DiagSumHM)
DiagSumHM %>% filter(住院科別 %in% DiagSumHM[DiagSumHM$N>10,]$住院科別)
DiagSumHM[DiagSumHM$N>10,]$住院科別
DiagSumHM
DeptList<-DiagSumHM[DiagSumHM$N>10,]$住院科別
DiagSumHM %>% filter(住院科別 %in% )
DeptList<-DiagSumHM[DiagSumHM$N>10,]$住院科別
DiagSumHM %>% filter(住院科別 %in% )
DeptList<-DiagSumHM[DiagSumHM$N>10,]$住院科別
DiagSumHM %>% filter(住院科別 %in% DeptList)
DeptList<-DiagSumHM[DiagSumHM$N>10,]$住院科別
DiagSumHM<-DiagSumHM %>% filter(住院科別 %in% DeptList)
ggplot(DiagSumHM, aes(住院年, 住院科別)) +
geom_tile(aes(fill = HosStay),
colour = "white")+
scale_fill_gradient(
low = "white",high = "steelblue") +
theme_bw()
library(tableone)
t1<-CreateTableOne(data=DiagSumS,
strata = "性別",
vars = c("年齡","來源別","住院天數"))
t1
